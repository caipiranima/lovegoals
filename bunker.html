<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Bunker</title>
        <link rel="stylesheet" href="css/floresta.css">
        <link rel="stylesheet" href="css/custombox.min.css">
        <script src="js/phaser.min.js" charset="utf-8"></script>
        <script src="js/custombox.min.js" charset="utf-8"></script>
    </head>
    <body>
        <script type="text/javascript">
        var POSITION_DEFS = [{
                x: 242,
                y: 202,
                w: 225,
                h: 107
            },{
                x: 870,
                y: 225,
                w: 225,
                h: 107
            },{
                x: 1137,
                y: 225,
                w: 225,
                h: 107
            },{
                x: 1665,
                y: 249,
                w: 225,
                h: 107,
                s: 1.2
            },{
                x: 15,
                y: 340,
                w: 150,
                h: 107
            },{
                x: 230,
                y: 356,
                w: 136,
                h: 100
            },{
                x: 434,
                y: 369,
                w: 126,
                h: 100
            },{
                x: 614,
                y: 368,
                w: 126,
                h: 100
            },{
                x: 789,
                y: 378,
                w: 126,
                h: 100
            },{
                x: 962,
                y: 372,
                w: 126,
                h: 100
            },{
                x: 1132,
                y: 374,
                w: 126,
                h: 100
            },{
                x: 1310,
                y: 368,
                w: 126,
                h: 100
            },{
                x: 1498,
                y: 354,
                w: 126,
                h: 100
            },{
                x: 12,
                y: 476,
                w: 153,
                h: 112
            },{
                x: 232,
                y: 478,
                w: 131,
                h: 102
            },{
                x: 434,
                y: 480,
                w: 126,
                h: 100
            },{
                x: 620,
                y: 480,
                w: 126,
                h: 100
            },{
                x: 792,
                y: 478,
                w: 126,
                h: 100
            },{
                x: 968,
                y: 477,
                w: 126,
                h: 100
            },{
                x: 1142,
                y: 476,
                w: 126,
                h: 100
            },{
                x: 1314,
                y: 472,
                w: 126,
                h: 100
            },{
                x: 1503,
                y: 465,
                w: 126,
                h: 100
            },{
                x: 1668,
                y: 420,
                w: 225,
                h: 107
            },{
                x: 10,
                y: 618,
                w: 168,
                h: 107,
                s: 1.2
            },{
                x: 200,
                y: 608,
                w: 185,
                h: 107,
                s: 1.1
            },{
                x: 400,
                y: 601,
                w: 164,
                h: 107
            },{
                x: 582,
                y: 596,
                w: 162,
                h: 107
            },{
                x: 766,
                y: 588,
                w: 162,
                h: 107
            },{
                x: 944,
                y: 588,
                w: 162,
                h: 107
            },{
                x: 1107,
                y: 590,
                w: 162,
                h: 107
            },{
                x: 1288,
                y: 590,
                w: 162,
                h: 107
            },{
                x: 1486,
                y: 590,
                w: 160,
                h: 107,
                s: 1.1
            },{
                x: 1692,
                y: 593,
                w: 156,
                h: 107,
                s: 1.1
            }
        ];

        var VIDEO_DEFS = [
            'https://youtu.be/AxkuUCPH6D0',
            'https://youtu.be/F4-R4GavWY8',
            'https://youtu.be/-ES84W6Bb_s',
            'https://youtu.be/SAjsnxPw26g',
            'https://youtu.be/5UvBOJi2_HY',
            'https://youtu.be/b6wcOfiecvo',
            'https://youtu.be/GDtufnDYgVM',
            'https://youtu.be/4DZpqUv6dmg',
            'https://youtu.be/88W-3bBvMkE',
            'https://youtu.be/0yaV_y7FcF4',
            'https://youtu.be/awqcr6I9a_0',
            'https://youtu.be/1M7AQ2JaQg8',
            'https://youtu.be/7EcleG_MLv8',
            'https://youtu.be/vZYh8hk9gSE',
            'https://youtu.be/KzDHdLFtfHE',
            'https://youtu.be/DJVCA9803iA',
            'https://youtu.be/yQuwJca6QLQ',
            'https://youtu.be/QlgtlhttS24',
            'https://youtu.be/9Af83ictC_s',
            'https://youtu.be/wpWqViIPyBw',
            'https://youtu.be/nCkHQkblNyU',
            'https://youtu.be/qtu0R75Cvbc',
            'https://youtu.be/mE2jEZekGLM',
            'https://youtu.be/dpVIVm2aj4k',
            'https://youtu.be/NXQ7YJoXQQE',
            'https://youtu.be/P9jgtHpu_Vw',
            'https://youtu.be/4uyzr_FdG8A',
            'https://youtu.be/JbyWk7KNZJo',
            'https://youtu.be/b8RNNNZQAW0',
            'https://youtu.be/JeBeuXrEgRI',
            'https://youtu.be/xHb-6v4d6qw',
            'https://youtu.be/iAX6H1UE_D4',
            'https://youtu.be/9PJw1U0_rns',
        ]

        function shuffle(array) {
            var currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

        var screens = [];
        var screensSprites = [];

        var game = new Phaser.Game(1920, 1080, Phaser.AUTO, '', { preload: preload, create: create, update: update });

        function preload() {
            game.load.image('bunker', 'img/bunker.png');

            var nArray = [];
            for (i = 1; i < 34; i++) {
                nArray.push(i);
                game.load.image('m'+i, 'img/miniaturas-videos/'+i+'.png');
            }

            if (localStorage.getItem('screens') == null) {
                nArray = shuffle(nArray);

                for (i = 0; i < 33; i++) {
                    screens.push({
                        x: POSITION_DEFS[i].x,
                        y: POSITION_DEFS[i].y,
                        w: POSITION_DEFS[i].w,
                        h: POSITION_DEFS[i].h,
                        s: POSITION_DEFS[i].s,
                        nImage: nArray[i],
                        video: VIDEO_DEFS[nArray[i]-1],
                        watched: false
                    })
                }

                localStorage.setItem('screens', JSON.stringify(screens));
            } else {
                screens = JSON.parse(localStorage.getItem('screens'));
            }
        }

        function create() {
            for (i = 0; i < 33; i++) {
                var s = game.add.sprite(screens[i].x, screens[i].y, 'm'+screens[i].nImage);
                s.crop(new Phaser.Rectangle((225 - screens[i].w)/2, (107 - screens[i].h)/2, screens[i].w, screens[i].h));
                if (screens[i].s) {
                    s.scale.setTo(screens[i].s, screens[i].s)
                }
                s.inputEnabled = true;
                s.events.onInputDown.add(onClick, { nScreen: i });
                s.input.useHandCursor = true;
                if (screens[i].watched) {
                    s.alpha = 0.3;
                }
                screensSprites.push(s);
            }

            var bunker = game.add.sprite(0, 0, 'bunker');
        }

        function onClick(event) {
            if (event.wich == 1) {
                screens[this.nScreen].watched = true;
                localStorage.setItem('screens', JSON.stringify(screens));
                screensSprites[this.nScreen].alpha = 0.3;

                var modal = new Custombox.modal({
                  content: {
                    effect: 'fadein',
                    target: screens[this.nScreen].video
                  }
                });

                modal.open();
            }
        }

        function update() {

        }
        </script>
    </body>
</html>
