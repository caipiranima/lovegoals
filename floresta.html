<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Floresta</title>
        <link rel="stylesheet" href="css/floresta.css">
        <script src="js/phaser.min.js" charset="utf-8"></script>
        <script src="js/swipe.js" charset="utf-8"></script>
    </head>
    <body>
        <script type="text/javascript">

            //var Swipe = require('phaser-swipe');

            var gameWidth = window.innerWidth;
            var gameHeight = window.innerHeight;
            var tileWidth = (gameHeight*400)/1080;
            var nTiles = Math.ceil(gameWidth/tileWidth);

            var game = new Phaser.Game(nTiles*400, 1080, Phaser.AUTO, '', { preload: preload, create: create, update: update });

            var cursors, firstTile, lastTile, tiles;

            var resizeGame = function () {

                gameWidth = window.innerWidth;
                gameHeight = window.innerHeight;
                tileWidth = (gameHeight*400)/1080;
                nTiles = Math.ceil(gameWidth/tileWidth);

                game.width = gameWidth;
                game.height = gameHeight;

                //game.stage.bounds.height = gameHeight;

                if (game.renderType === 1) {
                    game.renderer.resize(gameWidth, gameHeight);
                    Phaser.Canvas.setSmoothingEnabled(game.context, false);
                }
            }
            // window.onresize = resizeGame

            function preload() {
                for (i = 1; i < 25; i++) {
                    game.load.image('f'+i, 'img/f'+i+'.jpg');
                }
            }

            function create() {
                this.swipe = new Swipe(this.game);
                tiles = game.add.group();

                for (i = 1; i <= nTiles; i++) {
                    tiles.create(0 + (i-1)*400, 0, 'f'+i);
                }
                firstTile = 1;
                lastTile = nTiles;

                game.scale.pageAlignHorizontally = true;
                game.scale.pageAlignVertically = true;
                resizeGame();

                cursors = game.input.keyboard.createCursorKeys();
            }

            function update() {
                var direction = this.swipe.check();
                if (direction!==null) {
                // direction= { x: x, y: y, direction: direction }
                    switch(direction.direction) {
                        case this.swipe.DIRECTION_LEFT:

                            if (tiles.getChildAt(tiles.length-1).x < (nTiles-1)*400) {
                                if (lastTile == 24)
                                    return;
                                lastTile++;
                                tiles.create(nTiles*400-5, 0, 'f'+lastTile);
                            }

                            if (tiles.getChildAt(0).x < -400) {
                                tiles.removeChildAt(0);
                                firstTile++;
                            }

                            tiles.setAll('x', 200, false, false, 2, false);

                            break;
                        case this.swipe.DIRECTION_RIGHT:
                            if (tiles.getChildAt(0).x > -5) {
                                if (firstTile == 1)
                                    return;
                                firstTile--;
                                var tile = game.add.sprite(-395, 0, 'f'+firstTile);
                                tiles.addAt(tile, 0);
                            }

                            if (tiles.getChildAt(tiles.length-1).x > (nTiles)*400) {
                                lastTile--;
                                tiles.removeChildAt(tiles.length-1);
                            }

                            tiles.setAll('x', 200, false, false, 1, false);
                    }
                }

                if (cursors.right.isDown) {
                    if (tiles.getChildAt(tiles.length-1).x < (nTiles-1)*400) {
                        if (lastTile == 24)
                            return;
                        lastTile++;
                        tiles.create(nTiles*400-5, 0, 'f'+lastTile);
                    }

                    if (tiles.getChildAt(0).x < -400) {
                        tiles.removeChildAt(0);
                        firstTile++;
                    }

                    tiles.setAll('x', 5, false, false, 2, false);
                } else if (cursors.left.isDown) {
                    if (tiles.getChildAt(0).x > -5) {
                        if (firstTile == 1)
                            return;
                        firstTile--;
                        var tile = game.add.sprite(-395, 0, 'f'+firstTile);
                        tiles.addAt(tile, 0);
                    }

                    if (tiles.getChildAt(tiles.length-1).x > (nTiles)*400) {
                        lastTile--;
                        tiles.removeChildAt(tiles.length-1);
                    }

                    tiles.setAll('x', 5, false, false, 1, false);
                }
            }
        </script>
    </body>
</html>
